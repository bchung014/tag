const SHINE_CYCLE = [
  [0, 17, 16, 16],
  [17, 17, 16, 16],
  [34, 17, 16, 16],
  [51, 17, 16, 16],
  [34, 17, 16, 16],
  [17, 17, 16, 16]
];

const GROUND = [
  [85, 0, 16, 16]
];

const HILL = [
  [153, 102, 16, 16], // hill top center
  [136, 102, 16, 16], // hill top left
  [170, 102, 16, 16], // hill top right
  [153, 119, 16, 16], // hill body center
  [136, 119, 16, 16], // hill body left
  [170, 119, 16, 16], // hill body right
];

const TREE = [
  [119, 0, 16, 16]
];

export default class Map {
  constructor(ctx) {
    this.ctx = ctx;

    this.tileMap = [
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0,
      0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0,
      1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
    ]; 

    this.assetMap = [
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      8, 8, 8, 8, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 8, 8, 8, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 2, 2, 2, 4, 0, 0, 0,
      0, 3, 2, 2, 2, 2, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 5, 5, 5, 7, 0, 0, 0,
      0, 6, 5, 5, 5, 5, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 5, 5, 5, 7, 0, 0, 0,
      0, 6, 5, 5, 5, 5, 7, 0, 0, 0, 0, 0, 0, 3, 2, 2, 2, 2, 2, 2, 4, 5, 5, 5, 7, 0, 0, 0,
      2, 2, 2, 4, 5, 5, 7, 0, 0, 0, 0, 0, 0, 6, 5, 5, 5, 5, 5, 5, 7, 5, 5, 5, 7, 0, 0, 0,
      5, 5, 5, 7, 5, 5, 7, 0, 3, 2, 2, 2, 2, 2, 2, 2, 4, 5, 5, 5, 7, 5, 5, 5, 7, 0, 0, 0,
      5, 5, 5, 7, 5, 5, 7, 0, 6, 5, 5, 5, 5, 5, 5, 5, 7, 5, 5, 5, 7, 5, 5, 5, 7, 0, 0, 0,
      2, 2, 2, 2, 2, 4, 7, 0, 6, 5, 5, 5, 5, 5, 5, 5, 7, 5, 5, 5, 7, 5, 5, 5, 3, 2, 2, 2,
      5, 5, 5, 5, 5, 7, 7, 0, 6, 5, 3, 2, 2, 2, 2, 2, 2, 2, 2, 4, 7, 5, 5, 5, 6, 5, 5, 5,
      5, 5, 5, 5, 5, 7, 7, 0, 6, 5, 6, 5, 5, 5, 5, 5, 5, 5, 5, 7, 7, 5, 5, 5, 6, 5, 5, 5,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
    ];
    
    this.extrasMap = [
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    ];

    this.tileSize = 50;
    this.rows = 14;
    this.cols = 28;

    this.frameCount = {
      shine: 0,
      delay: 0
    };

    this.image = this.getImage('./assets/tile_map.png');
  }

  getImage(imagePath) {
    const image = new Image();
    image.src = imagePath;
    return image;
  }

  redraw(x1, y1, x2, y2, tile) {
    this.ctx.drawImage(this.image, x1, y1, x2, y2, (tile % this.cols) * this.tileSize, Math.floor(tile / this.cols) * this.tileSize, this.tileSize, this.tileSize);
  }

  shine(tile) {
    this.redraw(...SHINE_CYCLE[Math.floor(this.frameCount.shine / 6)], tile);
    this.frameCount.delay++;

    if (this.frameCount.delay == 10) {
      this.frameCount.shine++;
      this.frameCount.delay = 0;
    }

    if (this.frameCount.shine === 36) this.frameCount.shine = 0;
  }

  draw() {
    for (let tile = 0; tile < this.assetMap.length; tile++) {
      let currTile = this.assetMap[tile];
        
      switch(currTile) {
        case 1:
          // this.shine(tile);
          this.redraw(...GROUND[0], tile);
          break;
        case 2:
          this.redraw(...HILL[0], tile);
          break;
        case 3:
          this.redraw(...HILL[1], tile);
          break;
        case 4:
          this.redraw(...HILL[2], tile);
          break;
        case 5: 
          this.redraw(...HILL[3], tile);
          break;
        case 6:
          this.redraw(...HILL[4], tile);
          break;          
        case 7:
          this.redraw(...HILL[5], tile);
          break;
        case 8:
          this.shine(tile);
          break;
        default:
          this.ctx.fillStyle = currTile === 0 ? "pink" : "black";
          this.ctx.fillRect((tile % this.cols) * this.tileSize, Math.floor(tile / this.cols) * this.tileSize, this.tileSize, this.tileSize);
          break;
      }
    }

    // for (let tile = 0; tile < this.extrasMap.length; tile++) {
    //   let currTile = this.extrasMap[tile];

    //   switch(currTile) {
    //     case 1:
    //       this.redraw(...TREE[0], tile);
    //       break;
    //   }

    // }


  }
}